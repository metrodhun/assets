!function(){let t=new WeakSet,e=new Set,o=document.documentElement.getAttribute("data-music-playing"),n=null!==localStorage.getItem("history_off");function r(r){if(t.has(r))return;t.add(r);const a=r.querySelector(".sg-h span"),i=r.querySelectorAll(".sNATXT a"),c=r.querySelector(".imgC"),l=r.querySelector(".sg-info.sTY span"),s=window.location.href,u=a?a.textContent.trim():"[no title]",d=Array.from(i).map((t=>t.textContent.trim())).join(", "),m=c?c.src:null,f=l?l.textContent.trim():null;r.querySelectorAll("button[data-play-id]").forEach((t=>{t.addEventListener("click",(()=>{if(n)return;if(t.classList.contains("mx-btn")&&t.classList.contains("onView"))return;const r=t.getAttribute("data-play-id");if(!r)return;const a=`${o}::${r}`;if(e.has(a))return;e.add(a);const i={id:r,songName:u,artists:d,source:s,image:m,time:Date.now(),type:f},c=function(){const t=localStorage.getItem("playHistory");try{return t?JSON.parse(t):[]}catch(t){return console.warn("[PlayHistory] malformed history, resetting"),[]}}();c.push(i),function(t){for(;t.length>100;)t.shift();localStorage.setItem("playHistory",JSON.stringify(t))}(c)}))}))}function a(){document.querySelectorAll(".topSong").forEach(r);new MutationObserver((t=>{n||t.forEach((t=>{t.addedNodes.forEach((t=>{t instanceof HTMLElement&&(t.matches(".topSong")?r(t):t.querySelectorAll&&t.querySelectorAll(".topSong").forEach(r))}))}))})).observe(document.body,{childList:!0,subtree:!0})}window.addEventListener("storage",(t=>{"history_off"===t.key&&(n=null!==localStorage.getItem("history_off"))}));new MutationObserver((a=>{a.forEach((a=>{if("data-music-playing"===a.attributeName){const a=document.documentElement.getAttribute("data-music-playing");a&&a!==o&&(o=a,t=new WeakSet,e=new Set,n||document.querySelectorAll(".topSong").forEach(r))}}))})).observe(document.documentElement,{attributes:!0}),n||(window.watchForTopSong=a,a())}();
window.formatTimeAgo=function(a){const s=Date.now();let t=Math.floor((s-a)/1e3);return t<60?`${t} sec${1!==t?"s":""}`:(t=Math.floor(t/60),t<60?`${t} min${1!==t?"s":""}`:(t=Math.floor(t/60),t<24?`${t} hr${1!==t?"s":""}`:(t=Math.floor(t/24),t<365?`${t} day${1!==t?"s":""}`:(t=Math.floor(t/365),`${t} year${1!==t?"s":""}`))))},window.historyToLoad=function(){const a=document.getElementById("hisTL");if(!a)return;const s=localStorage.getItem("playHistory");if(!s)return void(a.innerHTML='<div class="f fdc gap-10 ai-c jc-c noItm"><div class="nItmSvg"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 24 24" role="presentation"><path d="M15.728 14.443a.91.91 0 0 1-1.286 1.286 3.433 3.433 0 0 0-2.443-1.012c-.923 0-1.79.359-2.443 1.012a.909.909 0 1 1-1.286-1.286 5.237 5.237 0 0 1 3.728-1.544 5.234 5.234 0 0 1 3.73 1.544zm-6.75-3.526c.226-.225.355-.538.355-.857s-.129-.631-.355-.857a1.222 1.222 0 0 0-.857-.355c-.319 0-.631.13-.857.355-.225.226-.355.539-.355.857s.13.632.355.857c.225.225.538.355.857.355s.632-.129.857-.355zm6.901-2.069c-.319 0-.631.13-.857.355-.226.226-.355.538-.355.857s.129.632.355.857c.226.225.538.355.857.355s.632-.13.857-.355c.226-.225.355-.538.355-.857s-.129-.631-.355-.857a1.224 1.224 0 0 0-.857-.355zM22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0z"></path></svg></div><div class="nItmTxt">No history, Nothing played yet...</div></div>');let t;try{t=JSON.parse(s)}catch(s){return console.error("Invalid playHistory JSON",s),void(a.textContent='<div class="f fdc gap-10 ai-c jc-c noItm"><div class="nItmSvg"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 24 24" role="presentation"><path d="M15.728 14.443a.91.91 0 0 1-1.286 1.286 3.433 3.433 0 0 0-2.443-1.012c-.923 0-1.79.359-2.443 1.012a.909.909 0 1 1-1.286-1.286 5.237 5.237 0 0 1 3.728-1.544 5.234 5.234 0 0 1 3.73 1.544zm-6.75-3.526c.226-.225.355-.538.355-.857s-.129-.631-.355-.857a1.222 1.222 0 0 0-.857-.355c-.319 0-.631.13-.857.355-.225.226-.355.539-.355.857s.13.632.355.857c.225.225.538.355.857.355s.632-.129.857-.355zm6.901-2.069c-.319 0-.631.13-.857.355-.226.226-.355.538-.355.857s.129.632.355.857c.226.225.538.355.857.355s.632-.13.857-.355c.226-.225.355-.538.355-.857s-.129-.631-.355-.857a1.224 1.224 0 0 0-.857-.355zM22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0z"></path></svg></div><div class="nItmTxt">Error loading history.</div></div>')}if(!Array.isArray(t)||0===t.length)return void(a.textContent='<div class="f fdc gap-10 ai-c jc-c noItm"><div class="nItmSvg"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 24 24" role="presentation"><path d="M15.728 14.443a.91.91 0 0 1-1.286 1.286 3.433 3.433 0 0 0-2.443-1.012c-.923 0-1.79.359-2.443 1.012a.909.909 0 1 1-1.286-1.286 5.237 5.237 0 0 1 3.728-1.544 5.234 5.234 0 0 1 3.73 1.544zm-6.75-3.526c.226-.225.355-.538.355-.857s-.129-.631-.355-.857a1.222 1.222 0 0 0-.857-.355c-.319 0-.631.13-.857.355-.225.226-.355.539-.355.857s.13.632.355.857c.225.225.538.355.857.355s.632-.129.857-.355zm6.901-2.069c-.319 0-.631.13-.857.355-.226.226-.355.538-.355.857s.129.632.355.857c.226.225.538.355.857.355s.632-.13.857-.355c.226-.225.355-.538.355-.857s-.129-.631-.355-.857a1.224 1.224 0 0 0-.857-.355zM22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0z"></path></svg></div><div class="nItmTxt">No history.</div></div>');t.reverse();const e=t.map(((a,s)=>{const t=s+1,e=a.artists||"";let i="";if(e.includes(","))i=e.split(",").map((a=>a.trim())).filter(Boolean).map((a=>`<a class="domLoadContent" data-dom-id="false" data-dom-auto="Artist" href="/search?q=${encodeURIComponent(a)}" data-dom-type="Post">${a}</a>`)).join(", ");else if(e.trim()){const a=e.trim();i=`<a class="domLoadContent" data-dom-id="false" data-dom-auto="Artist" href="/search?q=${encodeURIComponent(a)}" data-dom-type="Post">${a}</a>`}const o=window.formatTimeAgo(a.time||0);return`<div class="rasTTC"><div class="rasContent" data-history-song="${t}" data-history-id="${a.id}"><div class="rasNPP"><span class="numFD">${t}</span><button title="Play" class="btn mx-rel" data-play-from="MoreSongs" type="button" data-play-id="${a.id}"><span class="plyr-icon-play"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 256 256"><path d="M232.3,114.3,88.3,26.4a15.5,15.5,0,0,0-16.1-.3A15.8,15.8,0,0,0,64,40V216a15.8,15.8,0,0,0,8.2,13.9,15.5,15.5,0,0,0,16.1-.3l144-87.9a16,16,0,0,0,0-27.4Z"></path></svg></span><span class="plyr-icon-pause"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 256 256"><path d="M216,48V208a16,16,0,0,1-16,16H164a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h36A16,16,0,0,1,216,48ZM92,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H92a16,16,0,0,0,16-16V48A16,16,0,0,0,92,32Z"></path></svg></span><span class="plyr-equalizer"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 21 24"><line class="equalizer-slide" stroke="#fff" stroke-width="2" x1="3" y1="22" x2="3" y2="2"></line><line class="equalizer-slide" stroke="#fff" stroke-width="2" x1="8" y1="22" x2="8" y2="2"></line><line class="equalizer-slide" stroke="#fff" stroke-width="2" x1="13" y1="22" x2="13" y2="2"></line><line class="equalizer-slide" stroke="#fff" stroke-width="2" x1="18" y1="22" x2="18" y2="2"></line></svg></span></button></div><div class="rasTitle"><div class="rasTitleIn"><div class="elp1 rastSN"><a class="domLoadContent" data-dom-id="${a.id}" data-dom-type="Post" href="${a.source}">${a.songName}</a></div><div class="elp1 rastSGN">${i}</div></div></div><div class="rasExtra"><div class="rasFB"><button class="btn is-small is-primary fav-rmas" data-fav-id="${a.id}" title="Add to favorites" type="button"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 256 256"><path d="M128,216S28,160,28,92A52,52,0,0,1,128,72h0A52,52,0,0,1,228,92C228,160,128,216,128,216Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg></button></div><div class="rasDUR"><span>${o}</span></div><div class="rasMO"><button class="song-option more-menu" data-morelist-id="${a.id}" data-morelist-type="Song" data-morelist-image="${a.image||""}" data-morelist-url="${a.source}" data-morelist-artist="${e}" data-morelist-title="${a.songName}" title="View options" type="button"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 512 512"><path d="M304 256c0 26.5-21.5 48-48 48s-48-21.5-48-48 21.5-48 48-48 48 21.5 48 48zm120-48c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48zm-336 0c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48z"/></svg></button></div></div></div></div>`}));a.innerHTML=e.join("")},window.historyToLoad();
(async function(){const e=localStorage.getItem("playHistory");if(!e)return null;let t;try{if(t=JSON.parse(e),!Array.isArray(t)||0===t.length)return console.warn("playHistory is empty or not an array"),null}catch(e){return console.error("Malformed playHistory JSON:",e),null}t.sort(((e,t)=>e.time-t.time));const a=t[t.length-1],i=a.id;try{const e=await fetch(`/feeds/posts/default/${i}?alt=json`);if(!e.ok)return console.error(`Fetch failed for ID ${i}:`,e.status),null;const t=(await e.json()).entry.content.$t,s=(new DOMParser).parseFromString(t,"text/html").querySelector("#post-song-data");return s?{songId:i,musicId:s.getAttribute("data-music"),imageUrl:s.getAttribute("data-image"),songName:s.getAttribute("data-title-name"),artist:s.getAttribute("data-artist")||a.artists,duration:s.getAttribute("data-duration"),genre:s.getAttribute("data-genre"),language:s.getAttribute("data-language"),movie:s.getAttribute("data-movie"),songType:s.getAttribute("data-song-type"),playedAt:new Date(a.time),source:a.source}:(console.error("No #post-song-data element in fetched HTML"),null)}catch(e){return console.error("Error fetching/parsing song data:",e),null}})().then((e=>{e&&function(e){window.lastSongMeta=e;const t=document.getElementById("queue");if(!t)return;t.innerHTML="";const a=document.createElement("li");a.className="plyr-item is-current",a.dataset.queueId=e.songId,a.dataset.musicId=e.musicId,a.dataset.songSource=e.source,a.dataset.genre=e.genre||"",a.innerHTML=`<article class="f ai-c plyr-list-item-inner"><div class="f ai-c jc-c plyr-item-list dragQ"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 24 24"><path d="M16 2C17.1046 2 18 2.89543 18 4C18 5.10457 17.1046 6 16 6C14.8954 6 14 5.10457 14 4C14 2.89543 14.8954 2 16 2Z"></path><path d="M16 10C17.1046 10 18 10.8954 18 12C18 13.1046 17.1046 14 16 14C14.8954 14 14 13.1046 14 12C14 10.8954 14.8954 10 16 10Z"></path><path d="M8 18C9.10457 18 10 18.8954 10 20C10 21.1046 9.10457 22 8 22C6.89543 22 6 21.1046 6 20C6 18.8954 6.89543 18 8 18Z"></path><path d="M16 18C17.1046 18 18 18.8954 18 20C18 21.1046 17.1046 22 16 22C14.8954 22 14 21.1046 14 20C14 18.8954 14.8954 18 16 18Z"></path><path d="M8 2C9.10457 2 10 2.89543 10 4C10 5.10457 9.10457 6 8 6C6.89543 6 6 5.10457 6 4C6 2.89543 6.89543 2 8 2Z"></path><path d="M8 10C9.10457 10 10 10.8954 10 12C10 13.1046 9.10457 14 8 14C6.89543 14 6 13.1046 6 12C6 10.8954 6.89543 10 8 10Z"></path></svg></div><div class="plyr-item-list"><div class="plyr-queue-ca"><div class="plyr-qimg"><img alt="${e.songName} from History Image" width="40" src="${e.imageUrl}" loading="lazy" height="40" /><button class="btn queue-play" data-queue-play-id="${e.songId}" aria-label="Play Song History: ${e.songName}"><span class="plyr-icon-play"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 256 256"><path d="M232.3,114.3,88.3,26.4a15.5,15.5,0,0,0-16.1-.3A15.8,15.8,0,0,0,64,40V216a15.8,15.8,0,0,0,8.2,13.9,15.5,15.5,0,0,0,16.1-.3l144-87.9a16,16,0,0,0,0-27.4Z"></path></svg></span><span class="plyr-icon-pause"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 256 256"><path d="M216,48V208a16,16,0,0,1-16,16H164a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h36A16,16,0,0,1,216,48ZM92,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H92a16,16,0,0,0,16-16V48A16,16,0,0,0,92,32Z"></path></svg></span><span class="plyr-equalizer"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 21 24"><line class="equalizer-slide" stroke="#fff" stroke-width="2" x1="3" y1="22" x2="3" y2="2"></line><line class="equalizer-slide" stroke="#fff" stroke-width="2" x1="8" y1="22" x2="8" y2="2"></line><line class="equalizer-slide" stroke="#fff" stroke-width="2" x1="13" y1="22" x2="13" y2="2"></line><line class="equalizer-slide" stroke="#fff" stroke-width="2" x1="18" y1="22" x2="18" y2="2"></line></svg></span></button></div><div class="plyr-qinfo"><span class="plyr-qsn">${e.songName}</span><span class="plyr-qan">${e.artist}</span></div></div></div><div class="f ai-c jc-c plyr-item-list"><button class="rmM" data-remove-song-id="${e.songId}" aria-label="History Remove Song from Queue: ${e.songName}" type="button"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 768 768"><g><path d="M655.5,112.5C582.9,39.9,486.6,0,384,0S185.1,39.9,112.5,112.5S0,281.4,0,384s39.9,198.9,112.5,271.5S281.4,768,384,768 s198.9-39.9,271.5-112.5S768,486.6,768,384S728.1,185.1,655.5,112.5z M624.6,624.6C560.3,689,474.8,724.4,384,724.4 S207.7,689,143.4,624.6C10.7,492,10.7,276,143.4,143.4C207.7,79,293.2,43.6,384,43.6S560.3,79,624.6,143.4 C757.3,276,757.3,492,624.6,624.6z"></path><path d="M553.2,214.8c-8.6-8.6-22.3-8.6-30.9,0L384,353.1L245.7,214.8c-8.6-8.6-22.3-8.6-30.9,0c-8.6,8.6-8.6,22.3,0,30.9 L353.1,384L214.8,522.3c-8.6,8.6-8.6,22.3,0,30.9c4.2,4.2,9.9,6.5,15.4,6.5s11.2-2.1,15.4-6.5l138.3-138.3l138.3,138.3 c4.2,4.2,9.9,6.5,15.4,6.5c5.7,0,11.2-2.1,15.4-6.5c8.6-8.6,8.6-22.3,0-30.9L414.9,384l138.3-138.3 C561.8,237.1,561.8,223.4,553.2,214.8z"></path></g></svg></button></div><div class="f ai-c jc-c plyr-item-list"><button class="btn user-like-queue" data-fav-id="${e.songId}" aria-label="History Like from Queue: ${e.songName}" type="button"><svg class="hOff fn" aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 256 256"><path d="M128,216S28,160,28,92A52,52,0,0,1,128,72h0A52,52,0,0,1,228,92C228,160,128,216,128,216Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"></path></svg></button></div><div class="plyr-item-list"><span class="plyr-qsd">${e.duration}</span><button class="more-menu" data-morelist-id="${e.songId}" aria-label="History More from Queue: ${e.songName}" type="button" data-morelist-type="Song Queue" data-morelist-image="${e.imageUrl}" data-morelist-url="${e.source}" data-morelist-artist="${e.artist}" data-morelist-title="${e.songName}"><svg aria-hidden="true" focusable="false" role="presentation" viewBox="0 0 512 512"><path d="M304 256c0 26.5-21.5 48-48 48s-48-21.5-48-48 21.5-48 48-48 48 21.5 48 48zm120-48c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48zm-336 0c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48z"></path></svg></button></div></article>`,t.appendChild(a),applyPlayerItemColor();const i=document.getElementById("player");i&&i.classList.remove("hidden");const s=document.getElementById("p-img"),n=document.getElementById("p-title"),o=document.getElementById("p-artist"),r=document.getElementById("p-fav"),l=document.getElementById("p-more");s&&(s.style.backgroundImage=`url("${e.imageUrl}")`),n&&(n.innerHTML=`<a class="domLoadContent" data-dom-id="${e.songId}" href="${e.source}" data-dom-type="Post">${e.songName}</a>`),o&&(o.innerHTML=e.artist.split(",").map((e=>e.trim())).map((e=>`<a class="domLoadContent" href="/search?q=${encodeURIComponent(e)}">${e}</a>`)).join(", ")),r&&r.setAttribute("data-fav-id",e.songId),l&&(l.setAttribute("data-morelist-id",e.songId),l.setAttribute("data-morelist-type","Player")),window.rightTimeEl&&(window.rightTimeEl.textContent=e.duration),window.leftTimeEl&&(window.leftTimeEl.textContent="0:00");const d=[];e.artist&&d.push(...e.artist.split(",").map((e=>e.trim()))),e.genre&&d.push(e.genre),t.setAttribute("data-queue-meta",`[${[...new Set(d)].join(",")}]`),t.setAttribute("data-lang-queue",e.language||""),t.setAttribute("data-type-queue",e.songType||""),t.setAttribute("data-is-played-from","History"),e.movie?t.setAttribute("data-movie-queue-name",e.movie):t.removeAttribute("data-movie-queue-name")}(e),updateQueueData()})).catch(console.error),document.getElementById("toggle-play")?.addEventListener("click",(function(){const e=document.documentElement.classList;if(e.contains("is-initializing")||e.contains("is-playing")||e.contains("is-paused")||e.contains("is-buffering"))return;const t=document.querySelector("#queue li.plyr-item.is-current"),a=t?.dataset.musicId;if(a)if(window._iframeLoaded)window.ytPlayer.loadVideoById(a);else{const e=`https://www.youtube-nocookie.com/embed/${a}?controls=0&disablekb=1&enablejsapi=1&iv_load_policy=3&modestbranding=1&playsinline=1&rel=0&showinfo=0&autoplay=1&mute=0&start=0`;document.getElementById("music").innerHTML=`<iframe id="youtube-player" class="w-full" src="${e}" allow="autoplay; encrypted-media; picture-in-picture"></iframe>`,window._iframeLoaded=!0,loadYouTubeAPI().then((e=>{window.ytPlayer=new e.Player("youtube-player",{events:{onReady:function(e){e.target.playVideo(),window.paceLoader.animate(),requestAnimationFrame(window.updateTime)},onStateChange:function(t){if(window.paceLoader.remove(),document.documentElement.classList.remove("is-initializing","is-playing","is-paused","is-buffering"),t.data===e.PlayerState.PLAYING)document.documentElement.classList.add("is-playing"),window.togglePlay&&(window.togglePlay.classList.add("is-pressed"),window.togglePlay.setAttribute("aria-pressed","true")),requestAnimationFrame(window.updateTime);else if(t.data===e.PlayerState.PAUSED)document.documentElement.classList.add("is-paused"),window.togglePlay&&(window.togglePlay.classList.remove("is-pressed"),window.togglePlay.setAttribute("aria-pressed","false"));else if(t.data===e.PlayerState.BUFFERING)document.documentElement.classList.add("is-buffering");else if(t.data===e.PlayerState.ENDED){const e=localStorage.getItem("repeat_song");"1"===e?(window.ytPlayer.seekTo(0,!0),window.ytPlayer.playVideo()):"2"===e?function(){if(document.querySelectorAll("#queue li.plyr-item").length<=1)return window.ytPlayer.seekTo(0,!0),void window.ytPlayer.playVideo();let e=document.querySelector("#queue li.plyr-item.is-current").nextElementSibling;for(;e&&!e.classList.contains("plyr-item");)e=e.nextElementSibling;if(e||(e=document.querySelector("#queue li.plyr-item:first-child")),e){const t=e.querySelector("[data-queue-play-id]");t&&handleQueueButtonPlay(t)}}():playNextSong(),requestAnimationFrame(window.updateTime)}}}})})).catch(console.error)}else console.error("No musicId found on current queue item")}));
